<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>URL-Launcher</title>
    <style>
        body { font-family: sans-serif; margin: 2rem; background: #f5dc8b; }
        h1 { font-size: 1.4rem; }
        input, button { padding: 0.5rem; margin: 0.2rem; border-radius: 6px; border: 1px solid #ccc; }
        ul { list-style: none; padding: 0; }
        li { margin: 0.4rem 0; }
        .url-item { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            background: white; 
            padding: 0.4rem; 
            border-radius: 6px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); 
        }
        .url-label { font-weight: bold; margin-right: 1rem; min-width: 120px; }
        .url-text { flex: 1; text-align: left; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .url-actions button { margin-left: 0.5rem; }
        .edit-input { width: 180px; margin-right: 0.5rem; }
    </style>
</head>
<body>
    <h1>Link hinzufügen</h1>

    <input type="text" id="nameInput" placeholder="Name (z. B. Example)">
    <input type="text" id="urlInput" placeholder="https://example.com">
    <button onclick="addUrl()">Hinzufügen</button>
    <button onclick="openAll()">Alle öffnen</button>
    <button onclick="exportLinks()">Exportieren</button>
    <input type="file" id="importFile" accept="application/json" onchange="importLinks(event)" style="display:none;">
    <button onclick="document.getElementById('importFile').click()">Importieren</button>

    <h1>Link-Liste</h1>
    <ul id="urlList"></ul>

    <script>
        const nameInput = document.getElementById("nameInput");
        const urlInput = document.getElementById("urlInput");
        const urlList = document.getElementById("urlList");

        let links = JSON.parse(localStorage.getItem("links") || "[]");
        render();

        function addUrl() {
            let url = urlInput.value.trim();
            let name = nameInput.value.trim();
            if (!url || !name) return;

            if (!/^https?:\/\//i.test(url)) {
                url = "http://" + url;
            }

            links.push({ name, url });
            save();
            render();
            urlInput.value = "";
            nameInput.value = "";
        }

        function deleteUrl(index) {
            links.splice(index, 1);
            save();
            render();
        }

        function openUrl(url) {
            window.open(url, "_blank");
        }

        function copyUrl(url) {
            navigator.clipboard.writeText(url).then(() => {
                alert("URL kopiert: " + url);
            });
        }

        function editUrl(index) {
            const li = urlList.children[index];
            const link = links[index];

            li.innerHTML = `
                <input class="edit-input" type="text" id="editName${index}" value="${link.name}">
                <input class="edit-input" type="text" id="editUrl${index}" value="${link.url}">
                <button onclick="saveEdit(${index})">Speichern</button>
                <button onclick="render()">Abbrechen</button>
            `;
        }

        function saveEdit(index) {
            const newName = document.getElementById(`editName${index}`).value.trim();
            const newUrl = document.getElementById(`editUrl${index}`).value.trim();

            if (!newName || !newUrl) return;

            let url = newUrl;
            if (!/^https?:\/\//i.test(url)) {
                url = "http://" + url;
            }

            links[index] = { name: newName, url };
            save();
            render();
        }

        function openAll() {
            links.forEach(link => window.open(link.url, "_blank"));
        }

        function save() {
            localStorage.setItem("links", JSON.stringify(links));
        }

        function render() {
            links.sort((a, b) => a.name.localeCompare(b.name, 'de', { sensitivity: 'base' }));

            urlList.innerHTML = "";
            links.forEach((link, i) => {
                const li = document.createElement("li");
                li.className = "url-item";

                let displayUrl = link.url;
                if (displayUrl.length > 40) {
                    displayUrl = displayUrl.slice(0, 40) + "... (nicht vollständig)";
                }

                li.innerHTML = `
                    <span class="url-label">${link.name}</span>
                    <span class="url-text" title="${link.url}">${displayUrl}</span>
                    <div class="url-actions">
                        <button onclick="openUrl('${link.url}')">Öffnen</button>
                        <button onclick="copyUrl('${link.url}')">Kopieren</button>
                        <button onclick="editUrl(${i})">Bearbeiten</button>
                        <button onclick="deleteUrl(${i})">Löschen</button>
                    </div>
                `;
                urlList.appendChild(li);
            });
        }

        // --- Export/Import ---
        function exportLinks() {
            const dataStr = JSON.stringify(links, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);

            const a = document.createElement("a");
            a.href = url;
            a.download = "links.json";
            a.click();
            URL.revokeObjectURL(url);
        }

        function importLinks(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (Array.isArray(imported)) {
                        links = imported;
                        save();
                        render();
                    } else {
                        alert("Ungültige Datei.");
                    }
                } catch {
                    alert("Fehler beim Import.");
                }
            };
            reader.readAsText(file);
        }
    </script>
</body>
</html>